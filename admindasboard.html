<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Taguig Barangay Complaints</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 12px;
      font-weight: 500;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .status-badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-pending {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      color: #92400e;
    }

    .status-in-progress {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      color: #1e40af;
    }

    .status-resolved {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      color: #065f46;
    }

    .complaint-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .complaint-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, #DC143C 0%, #ff4d6d 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .complaint-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(220, 20, 60, 0.15);
    }

    .complaint-card:hover::before {
      opacity: 1;
    }

    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #DC143C;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .gradient-bg {
      background: linear-gradient(135deg, #DC143C 0%, #a00f2e 100%);
    }

    .verified-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    .unverified-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }

    .upload-area {
      border: 2px dashed #DC143C;
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
      background: rgba(220, 20, 60, 0.02);
    }

    .upload-area:hover {
      border-color: #a00f2e;
      background: rgba(220, 20, 60, 0.05);
    }

    .upload-area.drag-over {
      border-color: #a00f2e;
      background: rgba(220, 20, 60, 0.1);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      animation: scaleIn 0.3s ease-out;
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #DC143C;
      box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.1);
    }

    .stat-card {
      background: linear-gradient(135deg, rgba(220, 20, 60, 0.05) 0%, rgba(220, 20, 60, 0.02) 100%);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(220, 20, 60, 0.1);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body>
  <div id="app" class="min-h-full flex flex-col"></div>
  <script>
    const defaultConfig = {
      background_color: "#f5f5f5",
      surface_color: "#ffffff",
      text_color: "#1a1a1a",
      primary_action_color: "#DC143C",
      secondary_action_color: "#7c8a9e",
      font_family: "Inter",
      font_size: 16,
      app_title: "Taguig Barangay Complaints",
      app_subtitle: "Report and Track Community Issues",
      nav_taguig: "Taguig Complaints",
      nav_submit: "Submit Complaint",
      nav_my: "My Complaints",
      nav_updates: "Updates",
      nav_profile: "Profile"
    };

    let allComplaints = [];
    let currentView = 'taguig';
    let userProfile = {
      name: localStorage.getItem('userName') || '',
      email: localStorage.getItem('userEmail') || '',
      phone: localStorage.getItem('userPhone') || '',
      barangay: localStorage.getItem('userBarangay') || '',
      isVerified: localStorage.getItem('userVerified') === 'true',
      idDocument: localStorage.getItem('userIdDocument') || ''
    };

    let isAdminLoggedIn = localStorage.getItem('isAdminLoggedIn') === 'true';
    const ADMIN_USERNAME = 'admin';
    const ADMIN_PASSWORD = 'taguig2024';

    const categories = [
      "Road Maintenance",
      "Street Lighting",
      "Garbage Collection",
      "Noise Complaint",
      "Public Safety",
      "Water Supply",
      "Drainage/Flooding",
      "Other"
    ];

    const barangays = [
      "Bagumbayan", "Bambang", "Calzada", "Central Bicutan", "Central Signal Village",
      "Fort Bonifacio", "Hagonoy", "Ibayo-Tipas", "Katuparan", "Ligid-Tipas",
      "Lower Bicutan", "Maharlika Village", "Napindan", "New Lower Bicutan", "North Daang Hari",
      "North Signal Village", "Palingon", "Pinagsama", "San Miguel", "Santa Ana",
      "South Daang Hari", "South Signal Village", "Tanyag", "Tuktukan", "Upper Bicutan",
      "Ususan", "Wawa", "Western Bicutan"
    ];

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    function generateId() {
      return 'C-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
    }

    function getStatusBadgeClass(status) {
      if (status === 'Resolved') return 'status-resolved';
      if (status === 'In Progress') return 'status-in-progress';
      return 'status-pending';
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function getDisplayName(complaint) {
      if (complaint.is_anonymous) {
        return 'Anonymous';
      }
      return complaint.submitter_name || 'Anonymous';
    }

    function getVerificationBadge(complaint) {
      if (complaint.is_verified) {
        return '<span class="verified-badge"><span>‚úì</span> Verified</span>';
      }
      return '<span class="unverified-badge"><span>‚ö†</span> Unverified</span>';
    }

    async function handleSubmitComplaint(event) {
      event.preventDefault();
      
      const submitBtn = event.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="loading-spinner"></span>Submitting...';
      submitBtn.disabled = true;

      const formData = new FormData(event.target);
      const isAnonymous = formData.get('submissionType') === 'anonymous';
      
      const newComplaint = {
        complaint_id: generateId(),
        title: formData.get('title'),
        description: formData.get('description'),
        category: formData.get('category'),
        location: formData.get('location'),
        status: 'Pending',
        submitted_date: new Date().toISOString(),
        last_update: new Date().toISOString(),
        submitter_name: userProfile.name || 'Anonymous',
        is_anonymous: isAnonymous,
        is_verified: userProfile.isVerified,
        admin_response: ''
      };

      if (allComplaints.length >= 999) {
        showToast('Maximum limit of 999 complaints reached. Please contact the administrator.', 'error');
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return;
      }

      const result = await window.dataSdk.create(newComplaint);
      
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;

      if (result.isOk) {
        showToast('Complaint submitted successfully!');
        event.target.reset();
        currentView = 'my';
        renderApp();
      } else {
        showToast('Failed to submit complaint. Please try again.', 'error');
      }
    }

    function showAdminLoginModal() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="background-color: ${surfaceColor}; border-radius: 16px; max-width: 450px; width: 90%; box-shadow: 0 20px 50px rgba(0,0,0,0.3);">
          <div style="padding: 32px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h3 style="font-size: ${fontSize * 1.5}px; font-weight: 700; color: ${textColor}; margin: 0;">
                üîê Admin Login
              </h3>
              <button onclick="closeAdminLoginModal()" style="background: none; border: none; font-size: 28px; color: ${textColor}; opacity: 0.5; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                √ó
              </button>
            </div>

            <p style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin: 0 0 24px 0; line-height: 1.6;">
              Access the admin panel to manage and respond to complaints.
            </p>

            <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
              <div style="margin-bottom: 20px;">
                <label for="adminUsername" style="display: block; font-size: ${fontSize * 0.9}px; font-weight: 600; color: ${textColor}; margin-bottom: 8px;">
                  Username
                </label>
                <input 
                  type="text" 
                  id="adminUsername" 
                  name="username" 
                  required
                  autocomplete="username"
                  style="width: 100%; padding: 12px 14px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 10px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor};"
                  placeholder="Enter admin username"
                />
              </div>

              <div style="margin-bottom: 24px;">
                <label for="adminPassword" style="display: block; font-size: ${fontSize * 0.9}px; font-weight: 600; color: ${textColor}; margin-bottom: 8px;">
                  Password
                </label>
                <input 
                  type="password" 
                  id="adminPassword" 
                  name="password" 
                  required
                  autocomplete="current-password"
                  style="width: 100%; padding: 12px 14px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 10px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor};"
                  placeholder="Enter password"
                />
              </div>

              <button 
                type="submit"
                style="width: 100%; padding: 14px; font-size: ${fontSize * 1.05}px; font-weight: 600; color: white; background-color: ${primaryColor}; border: none; border-radius: 10px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s;"
              >
                Login
              </button>
            </form>

            <p style="font-size: ${fontSize * 0.75}px; color: ${textColor}; opacity: 0.5; margin: 16px 0 0 0; text-align: center;">
              Default credentials: admin / taguig2024
            </p>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    function closeAdminLoginModal() {
      const modal = document.querySelector('.modal-overlay');
      if (modal) {
        modal.remove();
      }
    }

    function handleAdminLogin(event) {
      event.preventDefault();
      
      const formData = new FormData(event.target);
      const username = formData.get('username');
      const password = formData.get('password');

      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        isAdminLoggedIn = true;
        localStorage.setItem('isAdminLoggedIn', 'true');
        showToast('Admin login successful!');
        closeAdminLoginModal();
        currentView = 'admin';
        renderApp();
      } else {
        showToast('Invalid credentials. Please try again.', 'error');
      }
    }

    function handleAdminLogout() {
      isAdminLoggedIn = false;
      localStorage.removeItem('isAdminLoggedIn');
      showToast('Logged out successfully');
      currentView = 'taguig';
      renderApp();
    }

    async function updateComplaintStatus(complaint, newStatus, adminResponse = '') {
      const updatedComplaint = {
        ...complaint,
        status: newStatus,
        last_update: new Date().toISOString(),
        admin_response: adminResponse
      };

      const updateBtn = document.querySelector(`button[data-complaint-id="${complaint.__backendId}"]`);
      if (updateBtn) {
        updateBtn.disabled = true;
        updateBtn.innerHTML = '<span class="loading-spinner"></span>Updating...';
      }

      const result = await window.dataSdk.update(updatedComplaint);

      if (updateBtn) {
        updateBtn.disabled = false;
        updateBtn.innerHTML = 'Update Status';
      }

      if (result.isOk) {
        showToast(`Complaint status updated to ${newStatus}`);
      } else {
        showToast('Failed to update complaint status', 'error');
      }
    }

    async function deleteComplaint(complaint) {
      const complaintCard = document.querySelector(`[data-card-id="${complaint.__backendId}"]`);
      if (!complaintCard) return;

      const deleteBtn = complaintCard.querySelector('.delete-btn');
      const confirmBtn = complaintCard.querySelector('.confirm-delete-btn');

      if (!confirmBtn) {
        deleteBtn.innerHTML = 'Confirm Delete?';
        deleteBtn.classList.add('confirm-delete-btn');
        
        const cancelBtn = document.createElement('button');
        cancelBtn.textContent = 'Cancel';
        cancelBtn.className = 'cancel-delete-btn';
        const config = window.elementSdk?.config || defaultConfig;
        const fontSize = config.font_size || defaultConfig.font_size;
        const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
        cancelBtn.style.cssText = `padding: 8px 16px; font-size: ${fontSize * 0.85}px; font-weight: 600; color: white; background-color: ${secondaryColor}; border: none; border-radius: 8px; cursor: pointer; margin-left: 8px;`;
        
        cancelBtn.onclick = () => {
          deleteBtn.innerHTML = 'üóëÔ∏è Delete';
          deleteBtn.classList.remove('confirm-delete-btn');
          cancelBtn.remove();
        };
        
        deleteBtn.parentElement.appendChild(cancelBtn);
        return;
      }

      deleteBtn.disabled = true;
      deleteBtn.innerHTML = '<span class="loading-spinner"></span>Deleting...';

      const result = await window.dataSdk.delete(complaint);

      if (result.isOk) {
        showToast('Complaint deleted successfully');
      } else {
        showToast('Failed to delete complaint', 'error');
        deleteBtn.disabled = false;
        deleteBtn.innerHTML = 'üóëÔ∏è Delete';
      }
    }

    function showVerificationModal() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="background-color: ${surfaceColor}; border-radius: 16px; max-width: 500px; width: 90%; max-height: 90%; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.3);">
          <div style="padding: 32px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h3 style="font-size: ${fontSize * 1.5}px; font-weight: 700; color: ${textColor}; margin: 0;">
                Account Verification
              </h3>
              <button onclick="closeVerificationModal()" style="background: none; border: none; font-size: 28px; color: ${textColor}; opacity: 0.5; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                √ó
              </button>
            </div>

            <p style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin: 0 0 24px 0; line-height: 1.6;">
              Verify your account by uploading a valid government-issued ID to access additional features and build trust in the community.
            </p>

            <div style="margin-bottom: 24px;">
              <label style="display: block; font-size: ${fontSize * 0.9}px; font-weight: 600; color: ${textColor}; margin-bottom: 12px;">
                Accepted Documents:
              </label>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: ${fontSize * 0.8}px; color: ${textColor}; opacity: 0.7;">
                <div>‚úì Driver's License</div>
                <div>‚úì Passport</div>
                <div>‚úì PhilID</div>
                <div>‚úì Voter's ID</div>
                <div>‚úì UMID</div>
                <div>‚úì SSS ID</div>
              </div>
            </div>

            <div id="uploadArea" class="upload-area" onclick="document.getElementById('fileInput').click()">
              <input type="file" id="fileInput" accept="image/*,.pdf" style="display: none;" onchange="handleFileSelect(event)">
              <div style="font-size: 48px; margin-bottom: 12px;">üìÑ</div>
              <p style="font-size: ${fontSize}px; font-weight: 600; color: ${primaryColor}; margin: 0 0 8px 0;">
                Click to upload or drag and drop
              </p>
              <p style="font-size: ${fontSize * 0.8}px; color: ${textColor}; opacity: 0.6; margin: 0;">
                PNG, JPG, or PDF (MAX. 5MB)
              </p>
            </div>

            <div id="filePreview" style="display: none; margin-top: 16px;"></div>

            <button 
              id="submitVerification"
              onclick="submitVerification()"
              disabled
              style="width: 100%; padding: 16px; margin-top: 24px; font-size: ${fontSize * 1.05}px; font-weight: 600; color: white; background-color: ${primaryColor}; border: none; border-radius: 12px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s; opacity: 0.5;"
            >
              Submit for Verification
            </button>

            <p style="font-size: ${fontSize * 0.75}px; color: ${textColor}; opacity: 0.5; margin: 16px 0 0 0; text-align: center; line-height: 1.5;">
              Your document will be securely stored and reviewed by administrators. We respect your privacy and will only use this for verification purposes.
            </p>
          </div>
        </div>
      `;

      document.body.appendChild(modal);

      const uploadArea = modal.querySelector('#uploadArea');
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('drag-over');
      });
      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('drag-over');
      });
      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFileSelect({ target: { files } });
        }
      });
    }

    function closeVerificationModal() {
      const modal = document.querySelector('.modal-overlay');
      if (modal) {
        modal.remove();
      }
    }

    let selectedFile = null;

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (file.size > 5 * 1024 * 1024) {
        showToast('File size exceeds 5MB limit', 'error');
        return;
      }

      const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'application/pdf'];
      if (!validTypes.includes(file.type)) {
        showToast('Invalid file type. Please upload PNG, JPG, or PDF', 'error');
        return;
      }

      selectedFile = file;

      const reader = new FileReader();
      reader.onload = (e) => {
        const config = window.elementSdk?.config || defaultConfig;
        const fontSize = config.font_size || defaultConfig.font_size;
        const textColor = config.text_color || defaultConfig.text_color;

        const preview = document.getElementById('filePreview');
        preview.style.display = 'block';
        preview.innerHTML = `
          <div style="display: flex; align-items: center; gap: 12px; padding: 16px; background: rgba(220, 20, 60, 0.05); border-radius: 8px; border: 1px solid rgba(220, 20, 60, 0.2);">
            <div style="font-size: 32px;">
              ${file.type === 'application/pdf' ? 'üìÑ' : 'üñºÔ∏è'}
            </div>
            <div style="flex: 1; min-width: 0;">
              <div style="font-size: ${fontSize * 0.9}px; font-weight: 600; color: ${textColor}; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                ${file.name}
              </div>
              <div style="font-size: ${fontSize * 0.75}px; color: ${textColor}; opacity: 0.6;">
                ${(file.size / 1024).toFixed(2)} KB
              </div>
            </div>
            <button onclick="clearFileSelection()" style="background: none; border: none; font-size: 20px; color: ${textColor}; opacity: 0.5; cursor: pointer; padding: 4px;">
              √ó
            </button>
          </div>
        `;

        const submitBtn = document.getElementById('submitVerification');
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';
        submitBtn.style.cursor = 'pointer';
      };
      reader.readAsDataURL(file);
    }

    function clearFileSelection() {
      selectedFile = null;
      document.getElementById('fileInput').value = '';
      document.getElementById('filePreview').style.display = 'none';
      
      const submitBtn = document.getElementById('submitVerification');
      submitBtn.disabled = true;
      submitBtn.style.opacity = '0.5';
    }

    function submitVerification() {
      if (!selectedFile) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        userProfile.isVerified = true;
        userProfile.idDocument = e.target.result;
        
        localStorage.setItem('userVerified', 'true');
        localStorage.setItem('userIdDocument', e.target.result);

        showToast('Verification submitted successfully! Your account is now verified.');
        closeVerificationModal();
        renderApp();
      };
      reader.readAsDataURL(selectedFile);
    }

    function renderHeader() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;

      return `
        <header class="gradient-bg" style="box-shadow: 0 4px 12px rgba(220, 20, 60, 0.2); font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
          <div class="max-w-7xl mx-auto px-4 py-8">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px;">
              <div style="font-size: 48px;">üèõÔ∏è</div>
              <div style="flex: 1;">
                <h1 style="font-size: ${fontSize * 2}px; font-weight: 800; color: white; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  ${config.app_title || defaultConfig.app_title}
                </h1>
                <p style="font-size: ${fontSize}px; color: white; opacity: 0.9; margin: 4px 0 0 0;">
                  ${config.app_subtitle || defaultConfig.app_subtitle}
                </p>
              </div>
              ${isAdminLoggedIn ? `
                <div style="text-align: right;">
                  <div style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 8px;">
                    <span style="font-size: ${fontSize * 0.85}px; color: white; font-weight: 600;">üë®‚Äçüíº Admin Mode</span>
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
        </header>
      `;
    }

    function renderNavigation() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;

      const navItems = isAdminLoggedIn ? [
        { id: 'admin', label: 'üë®‚Äçüíº Admin Panel', icon: 'üõ°Ô∏è' },
        { id: 'taguig', label: config.nav_taguig || defaultConfig.nav_taguig, icon: 'üèõÔ∏è' },
        { id: 'updates', label: config.nav_updates || defaultConfig.nav_updates, icon: 'üîî' }
      ] : [
        { id: 'taguig', label: config.nav_taguig || defaultConfig.nav_taguig, icon: 'üèõÔ∏è' },
        { id: 'submit', label: config.nav_submit || defaultConfig.nav_submit, icon: 'üìù' },
        { id: 'my', label: config.nav_my || defaultConfig.nav_my, icon: 'üìã' },
        { id: 'updates', label: config.nav_updates || defaultConfig.nav_updates, icon: 'üîî' },
        { id: 'profile', label: config.nav_profile || defaultConfig.nav_profile, icon: 'üë§' }
      ];

      return `
        <nav style="background-color: ${surfaceColor}; border-bottom: 1px solid rgba(0,0,0,0.08); box-shadow: 0 2px 8px rgba(0,0,0,0.05); font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
          <div class="max-w-7xl mx-auto px-4">
            <div style="display: flex; overflow-x: auto;">
              ${navItems.map(item => `
                <button 
                  onclick="currentView = '${item.id}'; renderApp();"
                  style="
                    padding: 18px 28px;
                    font-size: ${fontSize * 0.95}px;
                    font-weight: ${currentView === item.id ? '700' : '500'};
                    color: ${currentView === item.id ? primaryColor : textColor};
                    background-color: ${currentView === item.id ? `${primaryColor}10` : 'transparent'};
                    border: none;
                    border-bottom: 3px solid ${currentView === item.id ? primaryColor : 'transparent'};
                    cursor: pointer;
                    transition: all 0.2s;
                    white-space: nowrap;
                  "
                  onmouseover="if('${currentView}' !== '${item.id}') this.style.backgroundColor = 'rgba(220, 20, 60, 0.03)'"
                  onmouseout="if('${currentView}' !== '${item.id}') this.style.backgroundColor = 'transparent'"
                >
                  <span style="margin-right: 8px; font-size: ${fontSize * 1.2}px;">${item.icon}</span>
                  ${item.label}
                </button>
              `).join('')}
            </div>
          </div>
        </nav>
      `;
    }

    function renderAdminPanel() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      const sortedComplaints = [...allComplaints].sort((a, b) => 
        new Date(b.submitted_date) - new Date(a.submitted_date)
      );

      const statusCounts = {
        pending: allComplaints.filter(c => c.status === 'Pending').length,
        inProgress: allComplaints.filter(c => c.status === 'In Progress').length,
        resolved: allComplaints.filter(c => c.status === 'Resolved').length
      };

      return `
        <div style="background-color: ${backgroundColor}; padding: 24px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: calc(100% - 250px);">
          <div class="max-w-7xl mx-auto">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
              <div>
                <h2 style="font-size: ${fontSize * 1.75}px; font-weight: 700; color: ${textColor}; margin: 0 0 8px 0;">
                  üõ°Ô∏è Admin Panel
                </h2>
                <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7; margin: 0;">
                  Manage and respond to all complaints
                </p>
              </div>
              <button 
                onclick="handleAdminLogout()"
                style="padding: 12px 24px; font-size: ${fontSize * 0.95}px; font-weight: 600; color: white; background-color: ${secondaryColor}; border: none; border-radius: 10px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s;"
              >
                üö™ Logout
              </button>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px;">
              <div class="stat-card">
                <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: ${primaryColor}; margin-bottom: 4px;">
                  ${allComplaints.length}
                </div>
                <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                  Total Complaints
                </div>
              </div>
              <div class="stat-card">
                <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: #f59e0b; margin-bottom: 4px;">
                  ${statusCounts.pending}
                </div>
                <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                  Pending
                </div>
              </div>
              <div class="stat-card">
                <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: #3b82f6; margin-bottom: 4px;">
                  ${statusCounts.inProgress}
                </div>
                <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                  In Progress
                </div>
              </div>
              <div class="stat-card">
                <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: #10b981; margin-bottom: 4px;">
                  ${statusCounts.resolved}
                </div>
                <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                  Resolved
                </div>
              </div>
            </div>

            ${sortedComplaints.length === 0 ? `
              <div style="background-color: ${surfaceColor}; padding: 64px 32px; text-align: center; border-radius: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.06);">
                <div style="font-size: 80px; margin-bottom: 20px;">üì≠</div>
                <p style="font-size: ${fontSize * 1.3}px; font-weight: 600; color: ${textColor}; margin: 0;">
                  No complaints to manage
                </p>
              </div>
            ` : `
              <div style="display: flex; flex-direction: column; gap: 20px;">
                ${sortedComplaints.map(complaint => `
                  <div data-card-id="${complaint.__backendId}" class="complaint-card" style="background-color: ${surfaceColor}; padding: 28px; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06);">
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 20px; margin-bottom: 20px;">
                      <div>
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                          <h3 style="font-size: ${fontSize * 1.2}px; font-weight: 700; color: ${textColor}; margin: 0; line-height: 1.4;">
                            ${complaint.title}
                          </h3>
                          <span class="status-badge ${getStatusBadgeClass(complaint.status)}">
                            ${complaint.status}
                          </span>
                        </div>
                        
                        <p style="font-size: ${fontSize * 0.95}px; color: ${textColor}; opacity: 0.7; margin: 0 0 16px 0; line-height: 1.6;">
                          ${complaint.description}
                        </p>
                        
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 12px;">
                          <span style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.1) 0%, rgba(220, 20, 60, 0.05) 100%); padding: 6px 14px; border-radius: 8px; font-size: ${fontSize * 0.8}px; color: ${primaryColor}; font-weight: 600; border: 1px solid rgba(220, 20, 60, 0.2);">
                            üìÇ ${complaint.category}
                          </span>
                          <span style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.1) 0%, rgba(220, 20, 60, 0.05) 100%); padding: 6px 14px; border-radius: 8px; font-size: ${fontSize * 0.8}px; color: ${primaryColor}; font-weight: 600; border: 1px solid rgba(220, 20, 60, 0.2);">
                            üìç ${complaint.location}
                          </span>
                        </div>
                        
                        <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.6; line-height: 1.6;">
                          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                            <span style="font-weight: 600;">Submitted by: ${getDisplayName(complaint)}</span>
                            ${getVerificationBadge(complaint)}
                          </div>
                          <div>ID: ${complaint.complaint_id}</div>
                          <div>Submitted: ${formatDate(complaint.submitted_date)}</div>
                          <div>Last Update: ${formatDate(complaint.last_update)}</div>
                        </div>
                      </div>
                      
                      <div style="display: flex; flex-direction: column; gap: 12px; min-width: 200px;">
                        <label style="font-size: ${fontSize * 0.85}px; font-weight: 600; color: ${textColor};">
                          Update Status:
                        </label>
                        <select 
                          id="status-${complaint.__backendId}"
                          style="padding: 10px; font-size: ${fontSize * 0.9}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor};"
                        >
                          <option value="Pending" ${complaint.status === 'Pending' ? 'selected' : ''}>Pending</option>
                          <option value="In Progress" ${complaint.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                          <option value="Resolved" ${complaint.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                        </select>
                        
                        <textarea 
                          id="response-${complaint.__backendId}"
                          placeholder="Admin response (optional)"
                          rows="3"
                          style="padding: 10px; font-size: ${fontSize * 0.85}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; resize: vertical; color: ${textColor};"
                        >${complaint.admin_response || ''}</textarea>
                        
                        <button 
                          data-complaint-id="${complaint.__backendId}"
                          onclick="updateComplaintStatus(allComplaints.find(c => c.__backendId === '${complaint.__backendId}'), document.getElementById('status-${complaint.__backendId}').value, document.getElementById('response-${complaint.__backendId}').value)"
                          style="padding: 10px 16px; font-size: ${fontSize * 0.9}px; font-weight: 600; color: white; background: linear-gradient(135deg, ${primaryColor} 0%, #a00f2e 100%); border: none; border-radius: 8px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s;"
                        >
                          Update Status
                        </button>
                        
                        ${complaint.status === 'Resolved' ? `
                          <button 
                            class="delete-btn"
                            onclick="deleteComplaint(allComplaints.find(c => c.__backendId === '${complaint.__backendId}'))"
                            style="padding: 10px 16px; font-size: ${fontSize * 0.9}px; font-weight: 600; color: white; background-color: #ef4444; border: none; border-radius: 8px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s;"
                          >
                            üóëÔ∏è Delete
                          </button>
                        ` : ''}
                      </div>
                    </div>
                    
                    ${complaint.admin_response ? `
                      <div style="margin-top: 16px; padding: 16px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border-left: 4px solid #10b981; border-radius: 8px;">
                        <div style="font-size: ${fontSize * 0.85}px; font-weight: 700; color: #059669; margin-bottom: 6px;">
                          üë®‚Äçüíº Admin Response:
                        </div>
                        <div style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.8; line-height: 1.6;">
                          ${complaint.admin_response}
                        </div>
                      </div>
                    ` : ''}
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderTaguigComplaints() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;

      const sortedComplaints = [...allComplaints].sort((a, b) => 
        new Date(b.submitted_date) - new Date(a.submitted_date)
      );

      const statusCounts = {
        pending: allComplaints.filter(c => c.status === 'Pending').length,
        inProgress: allComplaints.filter(c => c.status === 'In Progress').length,
        resolved: allComplaints.filter(c => c.status === 'Resolved').length
      };

      return `
        <div style="background-color: ${backgroundColor}; padding: 24px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: calc(100% - 250px);">
          <div class="max-w-7xl mx-auto">
            <div style="margin-bottom: 32px;">
              <h2 style="font-size: ${fontSize * 1.75}px; font-weight: 700; color: ${textColor}; margin: 0 0 24px 0;">
                All Taguig Complaints
              </h2>
              
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="stat-card">
                  <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: ${primaryColor}; margin-bottom: 4px;">
                    ${allComplaints.length}
                  </div>
                  <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                    Total Complaints
                  </div>
                </div>
                <div class="stat-card">
                  <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: #f59e0b; margin-bottom: 4px;">
                    ${statusCounts.pending}
                  </div>
                  <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                    Pending
                  </div>
                </div>
                <div class="stat-card">
                  <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: #3b82f6; margin-bottom: 4px;">
                    ${statusCounts.inProgress}
                  </div>
                  <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                    In Progress
                  </div>
                </div>
                <div class="stat-card">
                  <div style="font-size: ${fontSize * 2}px; font-weight: 800; color: #10b981; margin-bottom: 4px;">
                    ${statusCounts.resolved}
                  </div>
                  <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.7; font-weight: 600;">
                    Resolved
                  </div>
                </div>
              </div>
            </div>

            ${sortedComplaints.length === 0 ? `
              <div style="background-color: ${surfaceColor}; padding: 64px 32px; text-align: center; border-radius: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.06);">
                <div style="font-size: 80px; margin-bottom: 20px;">üì≠</div>
                <p style="font-size: ${fontSize * 1.3}px; font-weight: 600; color: ${textColor}; margin: 0 0 8px 0;">
                  No complaints submitted yet
                </p>
                <p style="font-size: ${fontSize * 0.95}px; color: ${textColor}; opacity: 0.6; margin: 0;">
                  Be the first to report an issue in your community
                </p>
              </div>
            ` : `
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px;">
                ${sortedComplaints.map(complaint => `
                  <div class="complaint-card" style="background-color: ${surfaceColor}; padding: 24px; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                      <h3 style="font-size: ${fontSize * 1.15}px; font-weight: 700; color: ${textColor}; margin: 0; flex: 1; line-height: 1.4;">
                        ${complaint.title}
                      </h3>
                      <span class="status-badge ${getStatusBadgeClass(complaint.status)}">
                        ${complaint.status}
                      </span>
                    </div>
                    
                    <p style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin: 0 0 16px 0; line-height: 1.6;">
                      ${complaint.description}
                    </p>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 16px;">
                      <span style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.1) 0%, rgba(220, 20, 60, 0.05) 100%); padding: 6px 14px; border-radius: 8px; font-size: ${fontSize * 0.8}px; color: ${primaryColor}; font-weight: 600; border: 1px solid rgba(220, 20, 60, 0.2);">
                        üìÇ ${complaint.category}
                      </span>
                      <span style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.1) 0%, rgba(220, 20, 60, 0.05) 100%); padding: 6px 14px; border-radius: 8px; font-size: ${fontSize * 0.8}px; color: ${primaryColor}; font-weight: 600; border: 1px solid rgba(220, 20, 60, 0.2);">
                        üìç ${complaint.location}
                      </span>
                    </div>
                    
                    ${complaint.admin_response ? `
                      <div style="margin-bottom: 16px; padding: 12px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border-left: 3px solid #10b981; border-radius: 8px;">
                        <div style="font-size: ${fontSize * 0.8}px; font-weight: 700; color: #059669; margin-bottom: 4px;">
                          üë®‚Äçüíº Admin Response:
                        </div>
                        <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.8; line-height: 1.5;">
                          ${complaint.admin_response}
                        </div>
                      </div>
                    ` : ''}
                    
                    <div style="padding-top: 16px; border-top: 2px solid rgba(220, 20, 60, 0.1);">
                      <div style="font-size: ${fontSize * 0.8}px; color: ${textColor}; opacity: 0.6; line-height: 1.6;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                          <span style="font-weight: 600;">Submitted by: ${getDisplayName(complaint)}</span>
                          ${getVerificationBadge(complaint)}
                        </div>
                        <div>ID: ${complaint.complaint_id}</div>
                        <div>Date: ${formatDate(complaint.submitted_date)}</div>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderSubmitComplaint() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;

      return `
        <div style="background-color: ${backgroundColor}; padding: 24px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: calc(100% - 250px);">
          <div class="max-w-3xl mx-auto">
            <div style="background-color: ${surfaceColor}; padding: 40px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
              <div style="text-align: center; margin-bottom: 32px;">
                <div style="font-size: 64px; margin-bottom: 16px;">üìù</div>
                <h2 style="font-size: ${fontSize * 1.75}px; font-weight: 800; color: ${textColor}; margin: 0 0 8px 0;">
                  Submit a Complaint
                </h2>
                <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.6; margin: 0;">
                  Help improve our community by reporting issues
                </p>
              </div>

              <form id="complaintForm" onsubmit="handleSubmitComplaint(event)">
                <div style="margin-bottom: 24px;">
                  <label style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 14px;">
                    Submission Type *
                  </label>
                  <div style="display: flex; gap: 16px;">
                    <label style="flex: 1; cursor: pointer; padding: 16px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; transition: all 0.2s; display: flex; align-items: center; gap: 12px;" onmouseover="this.style.borderColor='rgba(220, 20, 60, 0.3)'" onmouseout="this.style.borderColor='rgba(0,0,0,0.1)'">
                      <input 
                        type="radio" 
                        name="submissionType" 
                        value="public" 
                        checked
                        onchange="document.getElementById('anonymousNote').style.display = 'none'"
                        style="width: 20px; height: 20px; cursor: pointer;"
                      />
                      <div>
                        <div style="font-size: ${fontSize * 0.95}px; color: ${textColor}; font-weight: 600; margin-bottom: 4px;">
                          üë§ Public
                        </div>
                        <div style="font-size: ${fontSize * 0.75}px; color: ${textColor}; opacity: 0.6;">
                          Show my name
                        </div>
                      </div>
                    </label>
                    <label style="flex: 1; cursor: pointer; padding: 16px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; transition: all 0.2s; display: flex; align-items: center; gap: 12px;" onmouseover="this.style.borderColor='rgba(220, 20, 60, 0.3)'" onmouseout="this.style.borderColor='rgba(0,0,0,0.1)'">
                      <input 
                        type="radio" 
                        name="submissionType" 
                        value="anonymous"
                        onchange="document.getElementById('anonymousNote').style.display = 'block'"
                        style="width: 20px; height: 20px; cursor: pointer;"
                      />
                      <div>
                        <div style="font-size: ${fontSize * 0.95}px; color: ${textColor}; font-weight: 600; margin-bottom: 4px;">
                          üïµÔ∏è Anonymous
                        </div>
                        <div style="font-size: ${fontSize * 0.75}px; color: ${textColor}; opacity: 0.6;">
                          Hide my name
                        </div>
                      </div>
                    </label>
                  </div>
                  <div id="anonymousNote" style="display: none; margin-top: 12px; padding: 14px 16px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 10px; font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.8; line-height: 1.6;">
                    <strong>‚ÑπÔ∏è Privacy Notice:</strong> Your verification status will still be displayed to maintain community trust and prevent spam, but your name will remain hidden.
                  </div>
                </div>

                <div style="margin-bottom: 24px;">
                  <label for="title" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                    Complaint Title *
                  </label>
                  <input 
                    type="text" 
                    id="title" 
                    name="title" 
                    required
                    style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor}; transition: all 0.2s;"
                    placeholder="Brief description of the issue"
                  />
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                  <div>
                    <label for="category" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                      Category *
                    </label>
                    <select 
                      id="category" 
                      name="category" 
                      required
                      style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor}; transition: all 0.2s;"
                    >
                      <option value="">Select category</option>
                      ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                    </select>
                  </div>

                  <div>
                    <label for="location" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                      Barangay Location *
                    </label>
                    <select 
                      id="location" 
                      name="location" 
                      required
                      style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor}; transition: all 0.2s;"
                    >
                      <option value="">Select barangay</option>
                      ${barangays.map(brgy => `<option value="${brgy}">${brgy}</option>`).join('')}
                    </select>
                  </div>
                </div>

                <div style="margin-bottom: 32px;">
                  <label for="description" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                    Detailed Description *
                  </label>
                  <textarea 
                    id="description" 
                    name="description" 
                    required
                    rows="6"
                    style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; resize: vertical; color: ${textColor}; line-height: 1.6; transition: all 0.2s;"
                    placeholder="Provide a detailed description of your complaint..."
                  ></textarea>
                </div>

                <button 
                  type="submit"
                  style="width: 100%; padding: 18px; font-size: ${fontSize * 1.1}px; font-weight: 700; color: white; background: linear-gradient(135deg, ${primaryColor} 0%, #a00f2e 100%); border: none; border-radius: 12px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s; box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);"
                  onmouseover="this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 6px 20px rgba(220, 20, 60, 0.4)'"
                  onmouseout="this.style.transform = 'translateY(0)'; this.style.boxShadow = '0 4px 12px rgba(220, 20, 60, 0.3)'"
                >
                  Submit Complaint
                </button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function renderMyComplaints() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;

      const myComplaints = allComplaints.filter(c => c.submitter_name === userProfile.name);

      return `
        <div style="background-color: ${backgroundColor}; padding: 24px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: calc(100% - 250px);">
          <div class="max-w-7xl mx-auto">
            <div style="margin-bottom: 32px;">
              <h2 style="font-size: ${fontSize * 1.75}px; font-weight: 700; color: ${textColor}; margin: 0 0 12px 0;">
                My Complaints
              </h2>
              <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7; margin: 0;">
                You have submitted <strong>${myComplaints.length}</strong> complaint${myComplaints.length !== 1 ? 's' : ''}
              </p>
            </div>

            ${myComplaints.length === 0 ? `
              <div style="background-color: ${surfaceColor}; padding: 64px 32px; text-align: center; border-radius: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.06);">
                <div style="font-size: 80px; margin-bottom: 20px;">üìù</div>
                <p style="font-size: ${fontSize * 1.3}px; font-weight: 600; color: ${textColor}; margin: 0 0 12px 0;">
                  You haven't submitted any complaints yet
                </p>
                <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.6; margin: 0 0 24px 0;">
                  Report issues in your community to help improve Taguig
                </p>
                <button 
                  onclick="currentView = 'submit'; renderApp();"
                  style="padding: 14px 32px; font-size: ${fontSize * 1.05}px; font-weight: 700; color: white; background: linear-gradient(135deg, ${primaryColor} 0%, #a00f2e 100%); border: none; border-radius: 12px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3); transition: all 0.2s;"
                  onmouseover="this.style.transform = 'translateY(-2px)'"
                  onmouseout="this.style.transform = 'translateY(0)'"
                >
                  Submit Your First Complaint
                </button>
              </div>
            ` : `
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px;">
                ${myComplaints.map(complaint => `
                  <div class="complaint-card" style="background-color: ${surfaceColor}; padding: 24px; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                      <div style="flex: 1;">
                        <h3 style="font-size: ${fontSize * 1.15}px; font-weight: 700; color: ${textColor}; margin: 0 0 8px 0; line-height: 1.4;">
                          ${complaint.title}
                        </h3>
                        ${complaint.is_anonymous ? `
                          <div style="display: inline-block; padding: 4px 10px; background: linear-gradient(135deg, rgba(124, 138, 158, 0.15) 0%, rgba(124, 138, 158, 0.1) 100%); border: 1px solid rgba(124, 138, 158, 0.3); border-radius: 6px; font-size: ${fontSize * 0.75}px; color: ${textColor}; opacity: 0.7;">
                            üïµÔ∏è Submitted Anonymously
                          </div>
                        ` : ''}
                      </div>
                      <span class="status-badge ${getStatusBadgeClass(complaint.status)}">
                        ${complaint.status}
                      </span>
                    </div>
                    
                    <p style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin: 0 0 16px 0; line-height: 1.6;">
                      ${complaint.description}
                    </p>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 16px;">
                      <span style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.1) 0%, rgba(220, 20, 60, 0.05) 100%); padding: 6px 14px; border-radius: 8px; font-size: ${fontSize * 0.8}px; color: ${primaryColor}; font-weight: 600; border: 1px solid rgba(220, 20, 60, 0.2);">
                        üìÇ ${complaint.category}
                      </span>
                      <span style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.1) 0%, rgba(220, 20, 60, 0.05) 100%); padding: 6px 14px; border-radius: 8px; font-size: ${fontSize * 0.8}px; color: ${primaryColor}; font-weight: 600; border: 1px solid rgba(220, 20, 60, 0.2);">
                        üìç ${complaint.location}
                      </span>
                    </div>
                    
                    ${complaint.admin_response ? `
                      <div style="margin-bottom: 16px; padding: 14px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border-left: 3px solid #10b981; border-radius: 8px;">
                        <div style="font-size: ${fontSize * 0.8}px; font-weight: 700; color: #059669; margin-bottom: 6px;">
                          üë®‚Äçüíº Admin Response:
                        </div>
                        <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.8; line-height: 1.5;">
                          ${complaint.admin_response}
                        </div>
                      </div>
                    ` : ''}
                    
                    <div style="padding-top: 16px; border-top: 2px solid rgba(220, 20, 60, 0.1);">
                      <div style="font-size: ${fontSize * 0.8}px; color: ${textColor}; opacity: 0.6; line-height: 1.6;">
                        <div>ID: ${complaint.complaint_id}</div>
                        <div>Submitted: ${formatDate(complaint.submitted_date)}</div>
                        <div>Last Update: ${formatDate(complaint.last_update)}</div>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderUpdates() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;

      const recentUpdates = [...allComplaints]
        .sort((a, b) => new Date(b.last_update) - new Date(a.last_update))
        .slice(0, 15);

      return `
        <div style="background-color: ${backgroundColor}; padding: 24px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: calc(100% - 250px);">
          <div class="max-w-5xl mx-auto">
            <div style="margin-bottom: 32px;">
              <h2 style="font-size: ${fontSize * 1.75}px; font-weight: 700; color: ${textColor}; margin: 0 0 12px 0;">
                Recent Updates
              </h2>
              <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7; margin: 0;">
                Latest updates on complaints across Taguig
              </p>
            </div>

            ${recentUpdates.length === 0 ? `
              <div style="background-color: ${surfaceColor}; padding: 64px 32px; text-align: center; border-radius: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.06);">
                <div style="font-size: 80px; margin-bottom: 20px;">üîî</div>
                <p style="font-size: ${fontSize * 1.3}px; font-weight: 600; color: ${textColor}; margin: 0 0 8px 0;">
                  No updates available yet
                </p>
                <p style="font-size: ${fontSize * 0.95}px; color: ${textColor}; opacity: 0.6; margin: 0;">
                  Check back later for complaint status updates
                </p>
              </div>
            ` : `
              <div style="display: flex; flex-direction: column; gap: 16px;">
                ${recentUpdates.map(complaint => `
                  <div style="background-color: ${surfaceColor}; padding: 24px; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border-left: 5px solid ${
                    complaint.status === 'Resolved' ? '#10b981' : 
                    complaint.status === 'In Progress' ? '#3b82f6' : '#f59e0b'
                  }; transition: all 0.2s;" onmouseover="this.style.boxShadow = '0 4px 20px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow = '0 2px 12px rgba(0,0,0,0.06)'">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                      <div style="flex: 1;">
                        <h3 style="font-size: ${fontSize * 1.1}px; font-weight: 700; color: ${textColor}; margin: 0 0 6px 0; line-height: 1.4;">
                          ${complaint.title}
                        </h3>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap; font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.6;">
                          <span>üìç ${complaint.location}</span>
                          <span>‚Ä¢</span>
                          <span>üìÇ ${complaint.category}</span>
                          <span>‚Ä¢</span>
                          <span>üë§ ${getDisplayName(complaint)}</span>
                          <span>‚Ä¢</span>
                          <span>${complaint.is_verified ? '‚úì Verified' : '‚ö† Unverified'}</span>
                        </div>
                      </div>
                      <span class="status-badge ${getStatusBadgeClass(complaint.status)}">
                        ${complaint.status}
                      </span>
                    </div>
                    
                    ${complaint.admin_response ? `
                      <div style="margin-bottom: 12px; padding: 12px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border-left: 3px solid #10b981; border-radius: 8px;">
                        <div style="font-size: ${fontSize * 0.8}px; font-weight: 700; color: #059669; margin-bottom: 4px;">
                          üë®‚Äçüíº Admin Response:
                        </div>
                        <div style="font-size: ${fontSize * 0.85}px; color: ${textColor}; opacity: 0.8; line-height: 1.5;">
                          ${complaint.admin_response}
                        </div>
                      </div>
                    ` : ''}
                    
                    <div style="font-size: ${fontSize * 0.8}px; color: ${textColor}; opacity: 0.5; font-weight: 600;">
                      Updated ${formatDate(complaint.last_update)}
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderProfile() {
      const config = window.elementSdk?.config || defaultConfig;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      return `
        <div style="background-color: ${backgroundColor}; padding: 24px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: calc(100% - 250px);">
          <div class="max-w-3xl mx-auto">
            <div style="background-color: ${surfaceColor}; padding: 40px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 24px;">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 32px;">
                <div style="display: flex; align-items: center; gap: 20px;">
                  <div style="width: 80px; height: 80px; background: linear-gradient(135deg, ${primaryColor} 0%, #a00f2e 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; box-shadow: 0 4px 16px rgba(220, 20, 60, 0.3);">
                    üë§
                  </div>
                  <div>
                    <h2 style="font-size: ${fontSize * 1.75}px; font-weight: 800; color: ${textColor}; margin: 0 0 8px 0;">
                      Profile Settings
                    </h2>
                    <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.6; margin: 0;">
                      Manage your account information
                    </p>
                  </div>
                </div>
                ${userProfile.isVerified ? `
                  <div class="verified-badge">
                    <span style="font-size: 16px;">‚úì</span>
                    Verified
                  </div>
                ` : `
                  <div class="unverified-badge">
                    <span style="font-size: 16px;">‚ö†</span>
                    Unverified
                  </div>
                `}
              </div>

              ${!userProfile.isVerified ? `
                <div style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.05) 0%, rgba(220, 20, 60, 0.02) 100%); border: 2px solid rgba(220, 20, 60, 0.2); border-radius: 16px; padding: 24px; margin-bottom: 32px;">
                  <div style="display: flex; align-items: start; gap: 16px;">
                    <div style="font-size: 32px;">üîê</div>
                    <div style="flex: 1;">
                      <h3 style="font-size: ${fontSize * 1.1}px; font-weight: 700; color: ${textColor}; margin: 0 0 8px 0;">
                        Verify Your Account
                      </h3>
                      <p style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin: 0 0 16px 0; line-height: 1.6;">
                        Upload a government-issued ID to verify your identity and gain access to additional features. Verified accounts are trusted by the community and help prevent spam.
                      </p>
                      <button 
                        onclick="showVerificationModal()"
                        style="padding: 12px 24px; font-size: ${fontSize * 0.95}px; font-weight: 700; color: white; background: linear-gradient(135deg, ${primaryColor} 0%, #a00f2e 100%); border: none; border-radius: 10px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s; box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);"
                        onmouseover="this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 6px 16px rgba(220, 20, 60, 0.4)'"
                        onmouseout="this.style.transform = 'translateY(0)'; this.style.boxShadow = '0 4px 12px rgba(220, 20, 60, 0.3)'"
                      >
                        Verify Account Now
                      </button>
                    </div>
                  </div>
                </div>
              ` : `
                <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 16px; padding: 24px; margin-bottom: 32px;">
                  <div style="display: flex; align-items: start; gap: 16px;">
                    <div style="font-size: 32px;">‚úÖ</div>
                    <div style="flex: 1;">
                      <h3 style="font-size: ${fontSize * 1.1}px; font-weight: 700; color: #059669; margin: 0 0 8px 0;">
                        Account Verified
                      </h3>
                      <p style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin: 0; line-height: 1.6;">
                        Your account has been successfully verified. You now have full access to all features and your complaints will be prioritized. Your verification status helps build community trust.
                      </p>
                    </div>
                  </div>
                </div>
              `}

              <div style="background: linear-gradient(135deg, rgba(124, 138, 158, 0.1) 0%, rgba(124, 138, 158, 0.05) 100%); border: 2px solid rgba(124, 138, 158, 0.2); border-radius: 16px; padding: 24px; margin-bottom: 32px;">
                <div style="display: flex; align-items: start; gap: 16px;">
                  <div style="font-size: 32px;">üë®‚Äçüíº</div>
                  <div style="flex: 1;">
                    <h3 style="font-size: ${fontSize * 1.1}px; font-weight: 700; color: ${textColor}; margin: 0 0 8px 0;">
                      Administrator Access
                    </h3>
                    <p style="font-size: ${fontSize * 0.9}px; color: ${textColor}; opacity: 0.7; margin: 0 0 16px 0; line-height: 1.6;">
                      Access the admin panel to manage complaints, update statuses, and respond to community issues.
                    </p>
                    <button 
                      onclick="showAdminLoginModal()"
                      style="padding: 12px 24px; font-size: ${fontSize * 0.95}px; font-weight: 700; color: white; background: linear-gradient(135deg, ${secondaryColor} 0%, #5d6b7e 100%); border: none; border-radius: 10px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s; box-shadow: 0 4px 12px rgba(124, 138, 158, 0.3);"
                      onmouseover="this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 6px 16px rgba(124, 138, 158, 0.4)'"
                      onmouseout="this.style.transform = 'translateY(0)'; this.style.boxShadow = '0 4px 12px rgba(124, 138, 158, 0.3)'"
                    >
                      üîê Admin Login
                    </button>
                  </div>
                </div>
              </div>

              <form id="profileForm" onsubmit="event.preventDefault(); handleProfileUpdate();">
                <div style="margin-bottom: 24px;">
                  <label for="profileName" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                    Full Name *
                  </label>
                  <input 
                    type="text" 
                    id="profileName" 
                    name="name" 
                    required
                    value="${userProfile.name}"
                    style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor}; transition: all 0.2s;"
                    placeholder="Enter your full name"
                  />
                </div>

                <div style="margin-bottom: 24px;">
                  <label for="profileEmail" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                    Email Address
                  </label>
                  <input 
                    type="email" 
                    id="profileEmail" 
                    name="email" 
                    value="${userProfile.email}"
                    style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor}; transition: all 0.2s;"
                    placeholder="your.email@example.com"
                  />
                </div>

                <div style="margin-bottom: 24px;">
                  <label for="profilePhone" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                    Phone Number
                  </label>
                  <input 
                    type="tel" 
                    id="profilePhone" 
                    name="phone" 
                    value="${userProfile.phone}"
                    style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor}; transition: all 0.2s;"
                    placeholder="09XX XXX XXXX"
                  />
                </div>

                <div style="margin-bottom: 32px;">
                  <label for="profileBarangay" style="display: block; font-size: ${fontSize * 0.95}px; font-weight: 700; color: ${textColor}; margin-bottom: 10px;">
                    Barangay
                  </label>
                  <select 
                    id="profileBarangay" 
                    name="barangay" 
                    style="width: 100%; padding: 14px 16px; font-size: ${fontSize}px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: ${textColor}; transition: all 0.2s;"
                  >
                    <option value="">Select your barangay</option>
                    ${barangays.map(brgy => `
                      <option value="${brgy}" ${userProfile.barangay === brgy ? 'selected' : ''}>
                        ${brgy}
                      </option>
                    `).join('')}
                  </select>
                </div>

                <button 
                  type="submit"
                  style="width: 100%; padding: 18px; font-size: ${fontSize * 1.1}px; font-weight: 700; color: white; background: linear-gradient(135deg, ${primaryColor} 0%, #a00f2e 100%); border: none; border-radius: 12px; cursor: pointer; font-family: ${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s; box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);"
                  onmouseover="this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 6px 20px rgba(220, 20, 60, 0.4)'"
                  onmouseout="this.style.transform = 'translateY(0)'; this.style.boxShadow = '0 4px 12px rgba(220, 20, 60, 0.3)'"
                >
                  Save Profile
                </button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function handleProfileUpdate() {
      const form = document.getElementById('profileForm');
      const formData = new FormData(form);
      
      userProfile.name = formData.get('name');
      userProfile.email = formData.get('email');
      userProfile.phone = formData.get('phone');
      userProfile.barangay = formData.get('barangay');

      localStorage.setItem('userName', userProfile.name);
      localStorage.setItem('userEmail', userProfile.email);
      localStorage.setItem('userPhone', userProfile.phone);
      localStorage.setItem('userBarangay', userProfile.barangay);

      showToast('Profile updated successfully!');
    }

    function renderContent() {
      if (isAdminLoggedIn && currentView === 'admin') {
        return renderAdminPanel();
      }
      
      switch(currentView) {
        case 'taguig':
          return renderTaguigComplaints();
        case 'submit':
          return renderSubmitComplaint();
        case 'my':
          return renderMyComplaints();
        case 'updates':
          return renderUpdates();
        case 'profile':
          return renderProfile();
        default:
          return renderTaguigComplaints();
      }
    }

    async function onConfigChange(config) {
      renderApp();
    }

    function renderApp() {
      const app = document.getElementById('app');
      app.innerHTML = `
        ${renderHeader()}
        ${renderNavigation()}
        ${renderContent()}
      `;
    }

    const dataHandler = {
      onDataChanged(data) {
        allComplaints = data;
        renderApp();
      }
    };

    async function initializeApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize data SDK");
        return;
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["app_subtitle", config.app_subtitle || defaultConfig.app_subtitle],
            ["nav_taguig", config.nav_taguig || defaultConfig.nav_taguig],
            ["nav_submit", config.nav_submit || defaultConfig.nav_submit],
            ["nav_my", config.nav_my || defaultConfig.nav_my],
            ["nav_updates", config.nav_updates || defaultConfig.nav_updates],
            ["nav_profile", config.nav_profile || defaultConfig.nav_profile]
          ])
        });
      }

      renderApp();
    }

    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a2011f3344b9ce7',t:'MTc2MzcyNjg4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>